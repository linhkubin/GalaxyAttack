{"version":3,"sources":["assets\\_Game\\Script\\Ship.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport Bullet from \"./Bullet\";\r\nimport SoundManager, { AudioType } from \"./Manager/SoundManager\";\r\nimport UIManager from \"./Manager/UIManager\";\r\nimport SimplePool, { PoolType } from \"./Pool/SimplePool\";\r\nimport Utilities from \"./Utilities\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Ship extends cc.Component {\r\n\r\n\r\n  @property({\r\n    type: [cc.Node],\r\n    tooltip: 'bulletPoints_1'\r\n  })\r\n  //list đạn ban đầu\r\n  public bulletPoints_1: cc.Node[] = [];\r\n\r\n  @property({\r\n    type: [cc.Node],\r\n    tooltip: 'bulletPoints_2'\r\n  })\r\n  //list đạn sau khi level up\r\n  public bulletPoints_2: cc.Node[] = [];\r\n  //list đạn bắn ra  \r\n  private bulletPoints : cc.Node[] = [];\r\n\r\n  @property(cc.Node)\r\n  private ripple: cc.Node = null;\r\n  @property(cc.Node)\r\n  private shield: cc.Node = null;\r\n\r\n\r\n  // private player: cc.Node;\r\n  private touchOffset: cc.Vec2;\r\n\r\n  //giới hạn khu vực điều khiển\r\n  private screen: cc.Vec2 = new cc.Vec2(cc.view.getVisibleSize().width, cc.view.getVisibleSize().height);\r\n  private clampHorizon: cc.Vec2;// = new cc.Vec2(-0.5, 0.5).mul(this.screen.x);\r\n  private clampVertical: cc.Vec2;// = new cc.Vec2(-0.5, 0.5).mul(this.screen.y);\r\n  \r\n  private isShooting: boolean = false;\r\n\r\n  \r\n  onLoad() {\r\n    // this.player = cc.find('player');\r\n    //set up move object\r\n    this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchBegan, this);\r\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMoved, this);\r\n\r\n    this.screen = new cc.Vec2(cc.view.getVisibleSize().width, cc.view.getVisibleSize().height);\r\n    this.clampHorizon = new cc.Vec2(-0.5, 0.5).mul(this.screen.x);\r\n    this.clampVertical = new cc.Vec2(-0.5, 0.5).mul(this.screen.y);\r\n\r\n    this.bulletPoints = this.bulletPoints_1;\r\n  }\r\n\r\n  \r\n  onDestroy() {\r\n    this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchBegan, this);\r\n    this.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMoved, this);\r\n  }\r\n\r\n  //Move\r\n\r\n  //bat dau an xuong\r\n  private onTouchBegan(event: cc.Event.EventTouch)/*: boolean*/ {\r\n    this.onStart();\r\n    this.touchOffset = Utilities.vec3ToVec2(this.node.position).subtract(this.getMousePoint(event));\r\n  }\r\n\r\n  //di chuyen chuot\r\n  private onTouchMoved(event: cc.Event.EventTouch) {\r\n    const newPos = this.getMousePoint(event).add(this.touchOffset);\r\n\r\n    newPos.x = cc.misc.clampf(newPos.x, this.clampHorizon.x, this.clampHorizon.y);\r\n    newPos.y = cc.misc.clampf(newPos.y, this.clampVertical.x, this.clampVertical.y);\r\n    \r\n    this.node.position = Utilities.vec2ToVec3(newPos);\r\n  }\r\n\r\n  //lay vi tri chuot bam xuong\r\n  private getMousePoint(event: cc.Event.EventTouch): cc.Vec2{\r\n    return event.getLocation().sub(cc.v2(this.screen.x * 0.5, this.screen.y * 0.5));\r\n  }\r\n\r\n  //------------------------------\r\n\r\n  private timer: number = 0;\r\n\r\n  update(dt: number) {\r\n \r\n    if (this.isShooting) {\r\n      //mỗi 0.2s bắn 1 lần\r\n      if (this.timer <= 0) {\r\n        this.timer += 0.2;\r\n        this.shoot();\r\n      }\r\n\r\n      this.timer -= dt;\r\n    }\r\n\r\n  }\r\n\r\n  //bắn đạn\r\n  private shoot(){\r\n    SoundManager.Ins.PlayClip(AudioType.FX_Bullet);\r\n    for (let i = 0; i < this.bulletPoints.length; i++) {\r\n      (SimplePool.spawn(PoolType.Bullet_1,  this.bulletPoints[i].getWorldPosition(),this.bulletPoints[i].angle) as Bullet).onInit(10);\r\n    }\r\n  }\r\n\r\n  public onPowerUp(): void {\r\n    this.bulletPoints = this.bulletPoints_2;\r\n    this.shield.active = true;\r\n    SoundManager.Ins.PlayClip(AudioType.FX_Booster);\r\n  }\r\n\r\n  public onAwake() {\r\n    this.moveTo(cc.Vec3.UP.mul(-500), 1 , \r\n    ()=> {\r\n      //bật tut\r\n      //bật fx\r\n      this.ripple.active = true;\r\n      UIManager.Ins.onOpen(0);\r\n    } ,false);\r\n  }\r\n\r\n  //khi player bắt đầu ấn xuống\r\n  public onStart(): void {\r\n    //bắt đầu bắn đạn\r\n    if (!this.isShooting) {\r\n      this.isShooting = true;\r\n      //tắt tut\r\n      //tắt fx\r\n      this.ripple.active = false;\r\n      UIManager.Ins.onClose(0);\r\n    }\r\n  }\r\n\r\n  public onFinish(): void {\r\n    //tàu k bắn đạn nữa, vụt đi\r\n    this.isShooting = false;\r\n    this.moveTo(this.node.position.add(cc.Vec3.UP.mul(-200)), 1 ,\r\n    ()=>  this.moveTo(this.node.position.add(cc.Vec3.UP.mul(10000)), 1 ,\r\n    //show UI end card\r\n    ()=> UIManager.Ins.onOpen(1) \r\n    ,false)\r\n    ,false);\r\n\r\n  }\r\n\r\n  //hàm di chuyển sang vị trí mới\r\n  public moveTo(target: cc.Vec3, duration: number, doneAction: Function, isWorldSpace: boolean): void {\r\n    // Lấy vị trí target position của node\r\n    const targetPosition = isWorldSpace ? this.node.getLocalPosition(target) : target;\r\n\r\n    // Tạo một tween để di chuyển node từ vị trí hiện tại đến vị trí mới (position)\r\n    cc.tween(this.node)\r\n      .to(duration,\r\n        { position: targetPosition },\r\n        { easing: \"linear\", }\r\n      )\r\n      .call(doneAction)\r\n      .start();\r\n  }\r\n}\r\n"]}